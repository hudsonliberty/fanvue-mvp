<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MidKnight VIP Services â€” MVP</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0b10; color:#e9e9f1; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 16px 64px; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width:44px; height:44px; border-radius:12px; background:linear-gradient(135deg,#ff2d8d,#7c3aed); display:grid; place-items:center; font-weight:800; }
    .profile { display:flex; align-items:center; gap:12px; }
    .avatar { width:36px; height:36px; border-radius:50%; object-fit:cover; background:#2a2a43; }
    .grid { display:grid; gap:14px; grid-template-columns: 1.1fr 0.9fr; margin-top:18px; }
    @media (max-width:900px){ .grid { grid-template-columns: 1fr; } }
    .card { border:1px solid #232338; background:#10101a; border-radius:16px; padding:16px; }
    h2 { font-size:13px; text-transform:uppercase; color:#7c7c98; margin:0 0 8px; }
    .btn { cursor:pointer; border:1px solid #2a2a43; background:#171724; color:#e9e9f1; border-radius:10px; padding:8px 12px; font-weight:600; }
    .btn.primary { background:linear-gradient(135deg,#6d28d9,#ff2d8d); border:0; }
    .btn.danger { background:#2a0f14; border-color:#b91c1c; color:#ffb4b4; }
    .textarea { width:100%; min-height:120px; border-radius:12px; border:1px solid #26263a; background:#0c0c13; color:#e9e9f1; padding:12px; font-family: ui-monospace, monospace; }
    .muted { color:#a7a7bd; font-size:12px; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  </style>
</head>

<body>
<div class="wrap">

  <!-- HEADER -->
  <div class="top">
    <div class="brand">
      <div class="logo">MV</div>
      <div>
        <div style="font-weight:800;">MidKnight VIP Services</div>
        <div class="muted">Fanvue Monetization Console</div>
      </div>
    </div>

    <div class="profile" id="profileBox" style="display:none;">
      <img id="avatar" class="avatar">
      <div>
        <div id="username"></div>
        <div id="handle" class="muted"></div>
      </div>
      <button class="btn danger" id="logoutBtn">Logout</button>
    </div>

    <button class="btn primary" id="loginBtn">Login</button>
  </div>

  <!-- MAIN -->
  <div class="grid">

    <!-- LEFT -->
    <div class="card">
      <h2>Webhook Payload</h2>
      <textarea id="payloadBox" class="textarea" readonly>// waiting for fan messageâ€¦</textarea>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <h2>Generated Reply</h2>
      <textarea id="replyTemplate" class="textarea">
Hey ðŸ˜˜ I saw your messageâ€¦ Iâ€™ve got something special for you tonight.
      </textarea>

      <div class="row" style="margin-top:8px;">
        <button class="btn primary" id="copyReplyBtn">Copy Reply</button>
        <span id="copyStatus" class="muted"></span>
      </div>
    </div>

  </div>
</div>

<script>
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const profileBox = document.getElementById('profileBox');
const avatar = document.getElementById('avatar');
const username = document.getElementById('username');
const handle = document.getElementById('handle');

const payloadBox = document.getElementById('payloadBox');
const replyBox = document.getElementById('replyTemplate');
const copyBtn = document.getElementById('copyReplyBtn');
const copyStatus = document.getElementById('copyStatus');

/* AUTH */
loginBtn.onclick = () => location.href = '/oauth/start';
logoutBtn.onclick = async () => {
  await fetch('/api/logout', { method:'POST' });
  location.reload();
};

async function loadProfile(){
  try {
    const r = await fetch('/api/me');
    if(!r.ok) return;
    const me = await r.json();
    profileBox.style.display='flex';
    loginBtn.style.display='none';
    avatar.src = me.avatar_url || '';
    username.textContent = me.username;
    handle.textContent = me.handle;
  } catch {}
}
loadProfile();

/* WEBHOOK POLL */
async function pollWebhook(){
  try {
    const r = await fetch('/api/events');
    if(!r.ok) return;
    const j = await r.json();
    if(j.events?.length){
      payloadBox.value = JSON.stringify(j.events[0].body, null, 2);
    }
  } catch {}
}
setInterval(pollWebhook, 1500);
pollWebhook();

/* COPY BUTTON */
copyBtn.onclick = async () => {
  const text = replyBox.value.trim();
  if(!text){
    copyStatus.textContent='Nothing to copy';
    return;
  }
  try{
    await navigator.clipboard.writeText(text);
    copyStatus.textContent='Copied âœ“';
    setTimeout(()=>copyStatus.textContent='',1500);
  }catch{
    copyStatus.textContent='Copy failed';
  }
};
</script>
</body>
</html>
